<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- 1. 基础适配配置：确保在米多客嵌入环境中正常显示 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>米多客侧边栏挂件（示例：指标大礼包）</title>
    
    <!-- 2. 依赖引入：米多客SDK必要资源 + 通用工具 -->
    <!-- 米多客基础样式（避免样式冲突） -->
    <link rel="stylesheet" href="https://mdclink.xianshangkefu.com/Web/css/midok-common.css">
    <!-- 图标库（可选，侧边栏常用） -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <!-- 3. 挂件专属样式：隔离命名空间，避免污染米多客主样式 -->
    <style>
        /* 命名空间前缀：midok-widget-xxx，防止样式冲突 */
        .midok-widget-container {
            width: 100%;
            padding: 16px;
            box-sizing: border-box;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .midok-widget-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #4A90E2, #5C6BC0);
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: opacity 0.3s;
        }
        .midok-widget-btn:hover {
            opacity: 0.9;
        }
        /* 响应式：适配米多客侧边栏不同宽度 */
        @media (max-width: 320px) {
            .midok-widget-container {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- 4. 挂件内容容器：结构清晰，便于米多客嵌入 -->
    <div class="midok-widget-container">
        <h3 style="margin: 0 0 16px; font-size: 16px; color: #333;">
            <i class="fa fa-bar-chart" aria-hidden="true"></i> 指标大礼包
        </h3>
        <p style="margin: 0 0 20px; font-size: 14px; color: #666;">
            点击下载客服数据指标模板，支持Excel/CSV格式
        </p>
        <!-- 5. 核心跳转按钮：解决“跳不动”问题 -->
        <button id="midok-widget-jump-btn" class="midok-widget-btn">
            <i class="fa fa-download" aria-hidden="true"></i> 立即下载
        </button>
    </div>

    <!-- 6. 米多客SDK集成 + 跳转逻辑：确保与主系统兼容 -->
    <script>
        // 关键：等待米多客主SDK加载完成后再执行（避免未定义错误）
        function initMidokWidget() {
            try {
                // 6.1 验证米多客SDK是否就绪
                if (typeof window._MICHAT !== 'function') {
                    console.warn('米多客SDK未加载，尝试延迟初始化');
                    setTimeout(initMidokWidget, 500); // 延迟重试
                    return;
                }

                // 6.2 跳转功能实现（3种常见场景，按需选择）
                const jumpBtn = document.getElementById('midok-widget-jump-btn');
                jumpBtn.addEventListener('click', function(e) {
                    e.preventDefault(); // 阻止默认行为，避免冲突
                    
                    // 场景1：跳转到同域HTML页面（米多客侧边栏推荐方式）
                // 注意：使用相对路径，确保与米多客主页面同域
                // 方式：用米多客内置方法打开（避免跳转后SDK断开）
                window._MICHAT('openUrl', {
                    url: './download/metrics-template.xlsx',
                    type: 'newTab', // 下载文件使用新标签页打开
                    crossDomain: false
                });
                
                // 显示下载成功提示
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0,0,0,0.8);
                    color: white;
                    padding: 10px 20px;
                    border-radius: 4px;
                    font-size: 14px;
                    z-index: 9999;
                `;
                notification.textContent = '文件下载已开始';
                document.body.appendChild(notification);
                setTimeout(() => {
                    notification.remove();
                }, 2000);

                    // 场景2：跳转到米多客内部功能页（如客服对话页）
                    // window._MICHAT('navigate', {
                    //     page: 'chatList', // 米多客内置页面标识（需查SDK文档）
                    //     params: { roomId: '123' } // 携带参数
                    // });

                    // 场景3：动态加载HTML内容（无需跳转，适合简单挂件）
                    // const contentContainer = document.querySelector('.midok-widget-container');
                    // contentContainer.innerHTML = '<div>加载后的内容...</div>';
                });

                console.log('米多客HTML挂件初始化完成');
            } catch (error) {
                console.error('米多客挂件初始化失败：', error);
                // 降级处理：跳转失败时显示提示
                document.getElementById('midok-widget-jump-btn').innerText = '加载失败，刷新重试';
            }
        }

        // 启动初始化：优先监听米多客SDK加载事件
        if (document.readyState === 'complete') {
            initMidokWidget();
        } else {
            // 监听页面加载完成 + 米多客SDK加载事件
            window.addEventListener('load', initMidokWidget);
            document.addEventListener('midokSdkReady', initMidokWidget); // 米多客自定义事件
        }
    </script>
</body>
</html>