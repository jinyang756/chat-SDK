# 米多客同域格式规范与验证指南

### 一、先明确：什么是 “同域”？（HTTP 同源策略）

米多客要求 “挂件页面与主页面同域”，核心是 **协议、域名、端口三者完全一致**（缺一不可），这是浏览器安全策略的要求，也是解决 “跳转不动” 的核心前提。



| 对比维度 | 同域要求          | 说明                                                                            |
| ---- | ------------- | ----------------------------------------------------------------------------- |
| 协议   | 必须完全一致        | 如主页面是`https`，挂件也必须是`https`（不能是`http`）                                         |
| 域名   | 一级 / 二级域名完全一致 | 如主页面是`kefu.abc.com`，挂件不能是`www.abc.com`（二级域名不同）                                |
| 端口   | 必须一致（默认端口可省略） | 如主页面是`https://kefu.abc.com:8443`，挂件也必须带`:8443`（`https`默认 443、`http`默认 80 可省略） |

### 二、同域格式的正确示例（结合米多客场景）

假设你的 **米多客主页面 URL** 是：`https://kefu.yourcompany.com/midok/main.html`（这是用户打开米多客客服系统的页面），则挂件页面需满足以下格式：

#### 1. 绝对路径格式（推荐，不易出错）



```
\<!-- 正确：协议、域名完全一致，端口默认443省略 -->

const targetUrl = "https://kefu.yourcompany.com/midok-widgets/qiliantong-download.html";

\<!-- 正确：带端口的场景（若主页面用了非默认端口） -->

\<!-- 主页面：https://kefu.yourcompany.com:8080/midok/main.html -->

const targetUrl = "https://kefu.yourcompany.com:8080/midok-widgets/qiliantong-download.html";
```

#### 2. 相对路径格式（需确保挂件与主页面目录关系正确）

以主页面路径 `https://kefu.yourcompany.com/midok/main.html` 为例：



```
\<!-- 场景1：挂件页面与主页面在同一目录下 -->

\<!-- 挂件实际路径：https://kefu.yourcompany.com/midok/qiliantong-download.html -->

const targetUrl = "./qiliantong-download.html";&#x20;

\<!-- 场景2：挂件页面在主页面的子目录下 -->

\<!-- 挂件实际路径：https://kefu.yourcompany.com/midok/widgets/qiliantong-download.html -->

const targetUrl = "./widgets/qiliantong-download.html";&#x20;

\<!-- 场景3：挂件页面在主页面的上级目录下 -->

\<!-- 挂件实际路径：https://kefu.yourcompany.com/widgets/qiliantong-download.html -->

const targetUrl = "../widgets/qiliantong-download.html";&#x20;
```

### 三、常见的 “不同域” 错误格式（跳转必失败）

仍以主页面 `https://kefu.yourcompany.com/midok/main.html` 为例，以下格式均不满足同域要求：



```
\<!-- 错误1：协议不同（主页面https，挂件http） -->

const targetUrl = "http://kefu.yourcompany.com/qiliantong-download.html";

\<!-- 错误2：二级域名不同（主页面kefu.xxx，挂件www.xxx） -->

const targetUrl = "https://www.yourcompany.com/qiliantong-download.html";

\<!-- 错误3：端口不同（主页面默认443，挂件用8080） -->

const targetUrl = "https://kefu.yourcompany.com:8080/qiliantong-download.html";

\<!-- 错误4：完全不同的域名（主页面yourcompany，挂件othercompany） -->

const targetUrl = "https://kefu.othercompany.com/qiliantong-download.html";
```

### 四、如何验证 “是否同域”？（快速自查步骤）



1.  **查看米多客主页面域名**

    打开米多客客服系统，在浏览器地址栏复制完整 URL（如 `https://kefu.abc.com/main.html`）。

2.  **查看挂件页面域名**

    将挂件 HTML 文件部署到服务器后，复制其访问 URL（如 `https://kefu.abc.com/widgets/download.html`）。

3.  **对比三要素**

    用表格对比两个 URL 的 “协议、域名、端口”：



| URL 类型 | 协议    | 域名                                   | 端口  | 是否同域 |
| ------ | ----- | ------------------------------------ | --- | ---- |
| 米多客主页面 | https | [kefu.abc.com](https://kefu.abc.com) | 443 | -    |
| 挂件页面   | https | [kefu.abc.com](https://kefu.abc.com) | 443 | 是    |
| 错误挂件页面 | https | [www.abc.com](https://www.abc.com)   | 443 | 否    |

### 五、特殊场景：跨域需求怎么处理？

若挂件页面必须跨域（如部署在 CDN 或不同域名），可通过米多客 SDK 的 **跨域兼容方案** 解决：



```
\<!-- 米多客SDK内置跨域打开方法（无需同域，但需主页面配置白名单） -->

window.\_MICHAT('openUrl', {

&#x20;   url: 'https://cdn.yourcompany.com/midok-widgets/download.html', // 跨域URL

&#x20;   type: 'sidebar',

&#x20;   crossDomain: true, // 开启跨域模式

&#x20;   whitelist: 'https://cdn.yourcompany.com' // 主页面需提前配置的跨域白名单

});
```

⚠️ 注意：跨域模式需在米多客管理后台 “开发者设置” 中添加挂件域名到 “跨域白名单”，否则会被浏览器拦截。

> （注：文档部分内容可能由 AI 生成）