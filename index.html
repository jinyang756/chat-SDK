<!doctype html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- 基本设置 -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>客服系统</title>
    
    <!-- 优先引入Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <!-- 性能优化 -->
    <meta http-equiv="Cache-Control" content="public, max-age=31536000">
    <meta name="format-detection" content="telephone=no">
    
    <!-- 性能优化 -->
    <meta http-equiv="Cache-Control" content="public, max-age=31536000">
    <meta name="format-detection" content="telephone=no">
    
    <!-- DNS预解析 -->
    <link rel="dns-prefetch" href="//mdclink.xianshangkefu.com">
    
    <!-- 提前建立连接 -->
    <link rel="preconnect" href="//mdclink.xianshangkefu.com" crossorigin>
</head>
<body>
    <script type="text/javascript">
        // 保留原客服链接代码不变
        window._MICHAT = window._MICHAT || function () { (_MICHAT.a = _MICHAT.a || []).push(arguments) };
        _MICHAT("cptid", "e773425b58e01513a5"); 
        _MICHAT("host", "mdclink.xianshangkefu.com"); 
        (function (m, d, q, j, s) { 
            j = d.createElement(q),s = d.getElementsByTagName(q)[0]; 
            j.async = true; 
            j.charset ="UTF-8"; 
            j.src = ("https:" == document.location.protocol ? "https://" : "http://") + "mdclink.xianshangkefu.com/Web/js/loader.js"; 
            s.parentNode.insertBefore(j, s); 
        })(window, document, "script");
    </script>
    
    <!-- 调试信息输出 -->
    <script>console.log('客服系统加载成功');</script>
    
    <!-- 领取指标大礼包按钮（图标+文字版） -->
    <div id="giftPackageButton" 
        style="
            position: fixed !important;
            top: 50% !important;
            right: 20px !important;
            transform: translateY(-50%) !important;
            z-index: 2147483647 !important;
            background: linear-gradient(135deg, #4A90E2, #5C6BC0) !important;
            color: white !important;
            padding: 12px 20px !important;
            border: none !important;
            border-radius: 25px !important;
            cursor: pointer !important;
            font-size: 14px !important;
            font-weight: bold !important;
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
            box-shadow: 0 4px 20px rgba(74, 144, 226, 0.4) !important;
            pointer-events: auto !important;
            will-change: transform !important;
            animation: subtleGlow 3s infinite alternate !important;
            min-width: 120px !important;
            transition: all 0.3s ease !important;
        "
        onclick="event.preventDefault(); event.stopPropagation(); console.log('HTML属性点击事件触发'); try { window.location.replace('qiliantong-download.html'); } catch (error) { console.error('HTML属性跳转错误:', error); }"
    >
        <i class="fa fa-bar-chart" aria-hidden="true" style="font-size: 16px !important;"></i>
        <span>指标大礼包</span>
    </div>
    
    <!-- 为礼包按钮添加动画和样式 -->
    <style>
        @keyframes subtleGlow {
            0% {
                box-shadow: 0 4px 20px rgba(74, 144, 226, 0.4);
                background: linear-gradient(135deg, #4A90E2, #5C6BC0);
            }
            100% {
                box-shadow: 0 6px 25px rgba(74, 144, 226, 0.6);
                background: linear-gradient(135deg, #5BA3F3, #6D82E3);
            }
        }
        
        #giftPackageButton:hover {
            transform: scale(1.05) translateY(-50%) !important;
            box-shadow: 0 8px 30px rgba(74, 144, 226, 0.7) !important;
        }
        
        #giftPackageButton:active {
            transform: scale(0.98) translateY(-50%) !important;
        }
        
        /* 响应式设计：在小屏幕上自动调整样式 */
        @media (max-width: 768px) {
            #giftPackageButton {
                right: 10px !important;
                font-size: 12px !important;
                padding: 10px 16px !important;
                min-width: auto !important;
            }
        }
    </style>
    
    <!-- 礼包按钮点击事件 -->
    <script>
        // 创建一个综合跳转函数，尝试多种方法
        function navigateToGiftPage() {
            console.log('尝试跳转到指标大礼包页面...');
            
            // 方法1: 使用location.href
            try {
                console.log('尝试方法1: window.location.href');
                window.location.href = 'qiliantong-download.html';
            } catch (error1) {
                console.error('方法1失败:', error1);
                
                // 方法2: 使用location.replace
                try {
                    console.log('尝试方法2: window.location.replace');
                    window.location.replace('qiliantong-download.html');
                } catch (error2) {
                    console.error('方法2失败:', error2);
                    
                    // 方法3: 使用window.open
                    try {
                        console.log('尝试方法3: window.open');
                        window.open('qiliantong-download.html', '_self');
                    } catch (error3) {
                        console.error('方法3失败:', error3);
                        
                        // 所有方法都失败时，显示提示
                        alert('无法自动跳转，请手动访问以下链接:\nhttp://localhost:8080/qiliantong-download.html');
                        console.error('所有跳转方法都失败，请手动访问链接');
                    }
                }
            }
        }
        
        // 等待DOM完全加载后再绑定点击事件
        document.addEventListener('DOMContentLoaded', function() {
            // 礼包按钮事件
            const giftButton = document.getElementById('giftPackageButton');
            if (giftButton) {
                console.log('礼包按钮已找到，准备绑定点击事件');
                giftButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    navigateToGiftPage();
                });
            } else {
                console.error('未找到礼包按钮元素');
            }
        });
        
        // 为用户提供一个直接可以复制的URL链接
        function showDirectUrl() {
            const url = 'http://localhost:8080/qiliantong-download.html';
            
            // 创建一个简单的浮窗显示直接链接
            const urlDisplay = document.createElement('div');
            urlDisplay.id = 'directUrlDisplay';
            urlDisplay.style.cssText = `
                position: fixed !important;
                bottom: 20px !important;
                left: 20px !important;
                z-index: 2147483647 !important;
                background: rgba(0, 0, 0, 0.8) !important;
                color: white !important;
                padding: 15px !important;
                border-radius: 10px !important;
                font-size: 12px !important;
                max-width: 90% !important;
                word-break: break-all !important;
                display: flex !important;
                align-items: center !important;
                gap: 10px !important;
            `;
            
            urlDisplay.innerHTML = `
                <span>无法自动跳转? 请手动访问:</span>
                <code style="background: rgba(255, 255, 255, 0.1); padding: 5px; border-radius: 4px;">${url}</code>
                <button onclick="navigateToGiftPage()" style="background: #4A90E2; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 11px;">再次尝试</button>
            `;
            
            document.body.appendChild(urlDisplay);
        }
        
        // 页面加载后3秒显示直接链接浮窗
        setTimeout(showDirectUrl, 3000);
    </script>

    <!-- 页面加载完成 -->
    <script>
        window.addEventListener('load', function() {
            console.log('页面加载完成');
        });
    </script>
    
    <!-- 礼包按钮防御机制 -->
    <script>
        // 核心防御机制：确保礼包按钮不被删除或隐藏
        function defendGiftButton() {
            const giftButton = document.getElementById('giftPackageButton');
            
            // 防御1：按钮被删除 → 立即重建
            if (!giftButton) {
                const newGiftButton = document.createElement('div');
                newGiftButton.id = 'giftPackageButton';
                newGiftButton.innerHTML = '<i class="fa fa-bar-chart" aria-hidden="true" style="font-size: 16px !important;"></i><span>指标大礼包</span>';
                newGiftButton.style.cssText = `
                    position: fixed !important;
                    top: 50% !important;
                    right: 20px !important;
                    transform: translateY(-50%) !important;
                    z-index: 2147483647 !important;
                    background: linear-gradient(135deg, #4A90E2, #5C6BC0) !important;
                    color: white !important;
                    padding: 12px 20px !important;
                    border: none !important;
                    border-radius: 25px !important;
                    cursor: pointer !important;
                    font-size: 14px !important;
                    font-weight: bold !important;
                    display: flex !important;
                    align-items: center !important;
                    gap: 8px !important;
                    box-shadow: 0 4px 20px rgba(74, 144, 226, 0.4) !important;
                    pointer-events: auto !important;
                    will-change: transform !important;
                    animation: subtleGlow 3s infinite alternate !important;
                    min-width: 120px !important;
                    transition: all 0.3s ease !important;
                `;
                newGiftButton.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('防御机制按钮点击事件触发');
                    try {
                        window.location.replace('qiliantong-download.html');
                    } catch (error) {
                        console.error('防御机制跳转错误:', error);
                    }
                };
                document.body.appendChild(newGiftButton);
            }
            
            // 防御2：按钮被隐藏 → 强制显示
            if (giftButton && (giftButton.style.display === 'none' || giftButton.style.visibility === 'hidden' || giftButton.style.opacity === '0')) {
                giftButton.style.display = 'flex !important';
                giftButton.style.visibility = 'visible !important';
                giftButton.style.opacity = '1 !important';
            }
            
            // 防御3：层级被覆盖 → 重置最高层级
            if (giftButton && parseInt(giftButton.style.zIndex) < 2147483647) {
                giftButton.style.zIndex = '2147483647 !important';
            }
        }
        
        // 高频监控：每50ms检查一次
        const checkInterval = setInterval(defendGiftButton, 50);
        
        // 页面加载完成后立即检查
        window.addEventListener('load', () => {
            defendGiftButton();
            // 延迟1秒再检查一次（应对可能的DOM操作）
            setTimeout(defendGiftButton, 1000);
        });
        
        // 监听DOM变化，确保按钮不被删除
        document.addEventListener('DOMNodeInserted', (e) => {
            // 若有新元素插入，检查按钮状态
            defendGiftButton();
        });
        
        // 防误删机制：重写可能删除按钮的DOM方法
        const originalRemoveChild = Node.prototype.removeChild;
        Node.prototype.removeChild = function(child) {
            if (child.id === 'giftPackageButton') {
                return child; // 假装删除，实际保留
            }
            return originalRemoveChild.call(this, child);
        };
        
        const originalSetAttribute = Element.prototype.setAttribute;
        Element.prototype.setAttribute = function(name, value) {
            if (this.id === 'giftPackageButton' && name === 'style' && 
                (value.includes('display:none') || value.includes('visibility:hidden'))) {
                return; // 忽略隐藏样式
            }
            return originalSetAttribute.call(this, name, value);
        };
    </script>
</body>
</html>