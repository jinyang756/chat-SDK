# 米多客侧边栏适配文件格式全指南（含实战代码）

### 一、核心适配格式详解（按场景优先级排序）

#### 1. HTML 格式：基础挂件首选（简单功能）

**适用场景**：表单提交、文件下载页、静态数据展示（如数据报表预览）

**核心优势**：零框架依赖，直接嵌入即可运行，兼容性最强

##### 集成方式（2 种主流方案）



| 集成方案           | 适用场景           | 代码示例       |
| -------------- | -------------- | ---------- |
| 1. iframe 直接嵌入 | 侧边栏固定挂件（如常驻工具） | \`\`\`html |

##### 避坑要点



*   避免在 HTML 中使用 `window.location.href` 跳转，会中断米多客 SDK 连接，必须用 `_MICHAT('openUrl')`

*   iframe 嵌入时，设置 `sandbox` 属性限制权限（如 `allow-scripts` 允许执行 JS，`allow-forms` 允许表单提交）

#### 2. JS 格式：功能插件开发（动态交互）

**适用场景**：数据统计、自定义聊天工具（如快捷回复编辑器）、API 对接功能（如调用企业 CRM 接口）

**核心优势**：可直接集成米多客 SDK 能力，支持动态注入功能，无需单独部署页面

##### 集成步骤（3 步完成）



1.  **开发 JS 插件（需暴露固定接口）**



```
// 插件文件：stat-plugin.js（需部署在同域服务器）

const MidokStatPlugin = {

&#x20; // 必须暴露 init 方法：米多客加载插件时自动调用

&#x20; init: function (midokSdk) {

&#x20;   console.log("统计插件初始化，SDK已就绪", midokSdk);

&#x20;  &#x20;

&#x20;   // 调用米多客SDK获取客服数据（插件核心能力）

&#x20;   midokSdk.get("chatData", { date: "today" }).then((res) => {

&#x20;     // 渲染统计结果到侧边栏

&#x20;     const container = document.querySelector(".sidebar-plugin-container");

&#x20;     container.innerHTML = \`\<div>今日对话量：\${res.chatCount}\</div>\`;

&#x20;   });

&#x20; },

&#x20; // 可选：插件卸载时的清理方法（如移除事件监听）

&#x20; destroy: function () {

&#x20;   console.log("统计插件已卸载");

&#x20; }

};

// 暴露插件到全局，供米多客SDK识别

window.MidokStatPlugin = MidokStatPlugin;
```



1.  **米多客主页面加载插件**



```
// 主页面初始化时加载JS插件

function loadStatPlugin() {

&#x20; if (typeof window.\_MICHAT !== "function") {

&#x20;   setTimeout(loadStatPlugin, 500);

&#x20;   return;

&#x20; }

&#x20;&#x20;

&#x20; // 用米多客SDK内置方法加载JS插件

&#x20; window.\_MICHAT("loadPlugin", {

&#x20;   type: "js",

&#x20;   url: "https://kefu.yourcompany.com/plugins/stat-plugin.js",  // 插件URL

&#x20;   pluginName: "MidokStatPlugin",  // 插件全局变量名（需与插件内一致）

&#x20;   container: ".sidebar-plugin-container"  // 插件渲染容器（侧边栏内的DOM节点）

&#x20; }).then(() => {

&#x20;   console.log("统计插件加载成功");

&#x20; }).catch((err) => {

&#x20;   console.error("插件加载失败：", err);

&#x20; });

}

// 启动加载

loadStatPlugin();
```



1.  **侧边栏添加插件容器**



```
\<!-- 米多客侧边栏HTML结构中添加 -->

\<div class="sidebar-plugin-container" style="padding: 16px;">\</div>
```

##### 关键要求



*   JS 插件必须暴露 `init` 方法（米多客 SDK 会传入自身实例，供插件调用 API）

*   插件 URL 必须与主页面同域，或在米多客跨域白名单内

#### 3. CSS 格式：样式扩展（美化 / 定制）

**适用场景**：修改侧边栏默认样式（如按钮颜色、字体）、自定义挂件样式（避免与米多客主样式冲突）

**核心优势**：轻量无依赖，直接覆盖或扩展样式，无需修改核心代码

##### 集成方式（2 种方案）



| 方案           | 适用场景          | 代码示例       |
| ------------ | ------------- | ---------- |
| 1. 直接嵌入 link | 固定样式扩展（如全局主题） | \`\`\`html |

// 用米多客 SDK 注入样式（确保样式作用于侧边栏）

window.\_MICHAT ("injectCss", {

content: cssContent,

scope: "sidebar"  // 限制样式仅作用于侧边栏（避免污染主页面）

});

}

// 调用注入

injectCustomCss ();



```
\##### 避坑要点

\- 样式必须加 \*\*命名空间前缀\*\*（如 \`midok-sidebar-xxx\`），避免覆盖米多客主样式

\- 用 \`injectCss\` 方法时，设置 \`scope: "sidebar"\` 确保样式仅作用于侧边栏，防止全局污染

\#### 4. JSON 格式：配置文件（动态菜单/参数）

\*\*适用场景\*\*：侧边栏菜单配置（如动态显示/隐藏菜单项）、插件参数配置（如统计插件的时间范围） &#x20;

\*\*核心优势\*\*：纯数据结构，便于动态修改（无需改代码），支持后端接口动态返回配置 &#x20;

\##### 集成步骤（以侧边栏菜单为例）

1\. \*\*准备JSON配置文件\*\* &#x20;

&#x20;  \`\`\`json

&#x20;  // 配置文件：sidebar-menu.json（可部署在服务器，或后端接口返回）

&#x20;  {

&#x20;    "menuList": \[

&#x20;      {

&#x20;        "id": "stat",

&#x20;        "name": "数据统计",

&#x20;        "icon": "fa-bar-chart",  // 依赖Font Awesome图标

&#x20;        "url": "./widgets/stat.html",  // 点击跳转的URL

&#x20;        "show": true  // 是否显示（可根据权限动态控制）

&#x20;      },

&#x20;      {

&#x20;        "id": "download",

&#x20;        "name": "文件下载",

&#x20;        "icon": "fa-download",

&#x20;        "url": "./widgets/download.html",

&#x20;        "show": true

&#x20;      },

&#x20;      {

&#x20;        "id": "feedback",

&#x20;        "name": "意见反馈",

&#x20;        "icon": "fa-comment",

&#x20;        "url": "./widgets/feedback.html",

&#x20;        "show": false  // 隐藏该菜单

&#x20;      }

&#x20;    ]

&#x20;  }
```



1.  **加载 JSON 并渲染菜单**



```
// 米多客侧边栏初始化时加载JSON配置

function loadSidebarMenu() {

&#x20; // 1. 请求JSON配置（同域场景，或跨域白名单内）

&#x20; fetch("https://kefu.yourcompany.com/configs/sidebar-menu.json")

&#x20;   .then((res) => res.json())

&#x20;   .then((config) => {

&#x20;     // 2. 渲染菜单到侧边栏

&#x20;     const menuContainer = document.querySelector(".sidebar-menu");

&#x20;     let menuHtml = "";

&#x20;    &#x20;

&#x20;     config.menuList.forEach((menu) => {

&#x20;       if (!menu.show) return;  // 不显示隐藏的菜单

&#x20;       menuHtml += \`

&#x20;         \<div class="sidebar-menu-item" data-id="\${menu.id}">

&#x20;           \<i class="fa \${menu.icon}" aria-hidden="true">\</i>

&#x20;           \<span>\${menu.name}\</span>

&#x20;         \</div>

&#x20;       \`;

&#x20;     });

&#x20;    &#x20;

&#x20;     menuContainer.innerHTML = menuHtml;

&#x20;    &#x20;

&#x20;     // 3. 绑定菜单点击事件（跳转）

&#x20;     document.querySelectorAll(".sidebar-menu-item").forEach((item) => {

&#x20;       item.addEventListener("click", () => {

&#x20;         const menuId = item.getAttribute("data-id");

&#x20;         const menu = config.menuList.find((m) => m.id === menuId);

&#x20;         if (menu) {

&#x20;           window.\_MICHAT("openUrl", { url: menu.url, type: "sidebar" });

&#x20;         }

&#x20;       });

&#x20;     });

&#x20;   })

&#x20;   .catch((err) => {

&#x20;     console.error("菜单配置加载失败：", err);

&#x20;   });

}

// 启动加载

loadSidebarMenu();
```



1.  **侧边栏添加菜单容器**



```
\<!-- 米多客侧边栏HTML中添加 -->

\<div class="sidebar-menu" style="display: flex; flex-direction: column; gap: 8px; padding: 16px;">\</div>
```

#### 5. Vue/React 格式：复杂功能开发（大型挂件）

**适用场景**：多页面交互的复杂挂件（如客服工单系统、客户管理工具）、需要组件化开发的功能

**核心优势**：组件化架构，便于维护和扩展，支持复杂状态管理（如 Vuex/Redux）

##### 集成关键步骤（以 Vue 为例）



1.  **开发 Vue 组件（常规 Vue 项目）**



```
\<!-- 示例：Vue工单列表组件 -->

\<template>

&#x20; \<div class="ticket-widget">

&#x20;   \<h3>客服工单列表\</h3>

&#x20;   \<table>

&#x20;     \<tr v-for="ticket in ticketList" :key="ticket.id">

&#x20;       \<td>{{ ticket.title }}\</td>

&#x20;       \<td>{{ ticket.status }}\</td>

&#x20;     \</tr>

&#x20;   \</table>

&#x20;   \<button @click="loadMore">加载更多\</button>

&#x20; \</div>

\</template>

\<script>

export default {

&#x20; data() {

&#x20;   return { ticketList: \[] };

&#x20; },

&#x20; mounted() {

&#x20;   // 调用米多客SDK获取工单数据（需确保SDK已加载）

&#x20;   window.\_MICHAT("get", "ticketList", { page: 1 }).then((res) => {

&#x20;     this.ticketList = res.list;

&#x20;   });

&#x20; },

&#x20; methods: {

&#x20;   loadMore() {

&#x20;     // 加载更多逻辑

&#x20;   }

&#x20; }

};

\</script>

\<style scoped>

.ticket-widget { padding: 16px; }

table { width: 100%; margin: 16px 0; }

\</style>
```



1.  **打包 Vue 项目为单页 HTML（关键配置）**

    修改 `vue.config.js`，确保打包后适配米多客侧边栏：



```
module.exports = {

&#x20; // 关键：设置publicPath为相对路径（确保同域加载）

&#x20; publicPath: "./", &#x20;

&#x20; outputDir: "dist",  // 打包输出目录

&#x20; // 适配侧边栏尺寸

&#x20; chainWebpack: (config) => {

&#x20;   config.plugin("html").tap((args) => {

&#x20;     args\[0].minify = false;  // 避免压缩导致的兼容性问题

&#x20;     args\[0].title = "客服工单系统";  // 侧边栏页面标题

&#x20;     return args;

&#x20;   });

&#x20; }

};
```

执行打包命令：`npm run build`，得到 `dist` 目录（含 `index.html`、`js`、`css`）。



1.  **集成到米多客侧边栏**

    将 `dist` 目录部署到与米多客主页面同域的服务器，然后用 `openUrl` 打开：



```
// 点击打开Vue工单挂件

document.getElementById("open-vue-widget").addEventListener("click", () => {

&#x20; window.\_MICHAT("openUrl", {

&#x20;   url: "https://kefu.yourcompany.com/widgets/ticket-system/index.html",  // 打包后的HTML路径

&#x20;   type: "sidebar"

&#x20; });

});
```

##### React 集成注意事项



*   打包时设置 `homepage: "./"`（在 `package.json` 中），确保相对路径正确

*   避免使用 `BrowserRouter`（会导致侧边栏 URL 混乱），改用 `HashRouter`

### 二、格式选择建议（按功能复杂度）



| 功能复杂度   | 推荐格式          | 示例场景        |
| ------- | ------------- | ----------- |
| 简单静态功能  | HTML + CSS    | 静态表单、文件下载页  |
| 动态交互功能  | JS + JSON     | 数据统计、动态菜单   |
| 复杂多页面功能 | Vue/React（打包） | 工单系统、客户管理工具 |
| 仅样式修改   | CSS           | 侧边栏主题定制     |

### 三、常见问题排查



1.  **格式加载失败**

*   检查 URL 是否同域或在跨域白名单内

*   用浏览器 F12 的「Network」面板查看资源是否返回 200 状态码（排除 404/403 错误）

1.  **样式冲突**

*   为自定义样式添加命名空间前缀（如 `midok-custom-xxx`）

*   用 `!important` 强制覆盖米多客默认样式（谨慎使用，优先用特异性更高的选择器）

1.  **Vue/React 打包后跳转不动**

*   确保 `publicPath` 设置为 `./`（相对路径），而非绝对路径

*   避免使用前端路由的 `push` 方法，改用米多客 `_MICHAT('openUrl')` 跳转

> （注：文档部分内容可能由 AI 生成）